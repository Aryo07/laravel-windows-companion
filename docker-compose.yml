version: "3.9"

name: laravel-infra

services:
  # =========================
  # MySQL 8 (Default)
  # =========================
  mysql:
    image: docker.io/library/mysql:8.0
    container_name: mysql8
    restart: unless-stopped
    ports:
      - "${MYSQL_PORT:-3306}:3306" # Jika port tidak diisi di .env, maka akan menggunakan port 3306
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-root} # Jika password tidak diisi di .env, maka akan menggunakan password root
      MYSQL_DATABASE: ${MYSQL_DATABASE:-laravel} # Jika database tidak diisi di .env, maka akan menggunakan database laravel
      MYSQL_USER: ${MYSQL_USER:-laravel} # Jika user tidak diisi di .env, maka akan menggunakan user laravel
      MYSQL_PASSWORD: ${MYSQL_PASSWORD:-secret} # Jika password tidak diisi di .env, maka akan menggunakan password secret
      TZ: Asia/Jakarta
    volumes:
      - mysql8_data:/var/lib/mysql
      - ./docker/mysql/my.cnf:/etc/mysql/conf.d/custom.cnf:ro
    command: >
      --default-authentication-plugin=mysql_native_password
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
    networks:
      - laravel

  # =========================
  # MariaDB 10.11 (LTS)
  # =========================
  mariadb:
    image: docker.io/library/mariadb:10.11
    container_name: mariadb1011
    restart: unless-stopped
    ports:
      - "${MARIADB_PORT:-3307}:3306" # Jika port tidak diisi di .env, maka akan menggunakan port 3307
    environment:
      MARIADB_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-root} # Jika password tidak diisi di .env, maka akan menggunakan password root
      MARIADB_DATABASE: ${MYSQL_DATABASE:-laravel} # Jika database tidak diisi di .env, maka akan menggunakan database laravel
      MARIADB_USER: ${MYSQL_USER:-laravel} # Jika user tidak diisi di .env, maka akan menggunakan user laravel
      MARIADB_PASSWORD: ${MYSQL_PASSWORD:-secret} # Jika password tidak diisi di .env, maka akan menggunakan password secret
      TZ: Asia/Jakarta
    volumes:
      - mariadb1011_data:/var/lib/mysql
      - ./docker/mariadb/my.cnf:/etc/mysql/conf.d/custom.cnf:ro
    networks:
      - laravel

  # =========================
  # Redis
  # =========================
  redis:
    image: docker.io/library/redis:7-alpine
    container_name: redis
    restart: unless-stopped
    ports:
      - "${REDIS_PORT:-6379}:6379" # Jika port tidak diisi di .env, maka akan menggunakan port 6379
    command: redis-server /usr/local/etc/redis/redis.conf
    volumes:
      - redis_data:/data
      - ./docker/redis/redis.conf:/usr/local/etc/redis/redis.conf:ro
    networks:
      - laravel

  # =========================
  # Mailpit (SMTP Catcher)
  # =========================
  mailpit:
    image: docker.io/axllent/mailpit
    container_name: mailpit
    restart: unless-stopped
    ports:
      - "${MAILPIT_SMTP_PORT:-1025}:1025"   # Jika port tidak diisi di .env, maka akan menggunakan port 1025 (SMTP)
      - "${MAILPIT_WEB_PORT:-8025}:8025"   # Jika port tidak diisi di .env, maka akan menggunakan port 8025 (Web UI)
    environment:
      MP_SMTP_AUTH_ACCEPT_ANY: "true"
      MP_SMTP_AUTH_ALLOW_INSECURE: "true"
    networks:
      - laravel

# =========================
# Networks
# =========================
networks:
  laravel:
    driver: bridge

# =========================
# Volumes
# =========================
volumes:
  mysql8_data:
  mariadb1011_data:
  redis_data:
