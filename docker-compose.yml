version: "3.9"

name: laravel-infra

services:
  # =========================
  # MySQL 8 (Default)
  # =========================
  mysql:
    image: docker.io/library/mysql:8.0
    container_name: mysql8
    restart: unless-stopped
    ports:
      - "3388:3306"
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DATABASE}
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}
      TZ: Asia/Jakarta
    volumes:
      - mysql8_data:/var/lib/mysql
      - ./docker/mysql/my.cnf:/etc/mysql/conf.d/custom.cnf:ro
    command: >
      --default-authentication-plugin=mysql_native_password
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
    networks:
      - laravel

  # =========================
  # MariaDB 10.11 (LTS)
  # =========================
  mariadb:
    image: docker.io/library/mariadb:10.11
    container_name: mariadb1011
    restart: unless-stopped
    ports:
      - "3389:3306"
    environment:
      MARIADB_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}
      MARIADB_DATABASE: ${MYSQL_DATABASE}
      MARIADB_USER: ${MYSQL_USER}
      MARIADB_PASSWORD: ${MYSQL_PASSWORD}
      TZ: Asia/Jakarta
    volumes:
      - mariadb1011_data:/var/lib/mysql
      - ./docker/mariadb/my.cnf:/etc/mysql/conf.d/custom.cnf:ro
    networks:
      - laravel

  # =========================
  # Redis
  # =========================
  redis:
    image: docker.io/library/redis:7-alpine
    container_name: redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    command: redis-server /usr/local/etc/redis/redis.conf
    volumes:
      - redis_data:/data
      - ./docker/redis/redis.conf:/usr/local/etc/redis/redis.conf:ro
    networks:
      - laravel

  # =========================
  # Mailpit (SMTP Catcher)
  # =========================
  mailpit:
    image: docker.io/axllent/mailpit
    container_name: mailpit
    restart: unless-stopped
    ports:
      - "1025:1025"   # SMTP
      - "8025:8025"   # Web UI
    environment:
      MP_SMTP_AUTH_ACCEPT_ANY: "true"
      MP_SMTP_AUTH_ALLOW_INSECURE: "true"
    networks:
      - laravel

# =========================
# Networks
# =========================
networks:
  laravel:
    driver: bridge

# =========================
# Volumes
# =========================
volumes:
  mysql8_data:
  mariadb1011_data:
  redis_data:
